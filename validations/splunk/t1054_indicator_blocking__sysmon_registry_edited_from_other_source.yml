name: '[T1054] Indicator Blocking - Sysmon registry edited from other source'
author: olafhartong
description: Hunting query based on sysmon or windows events for Splunk
reference: https://github.com/olafhartong/ThreatHunting
integration: Splunk
mitre_technique:
  id: T1054
queries:
- '`indextime` `sysmon` (event_id=12 OR event_id=13 OR event_id=14) (registry_key_path="HKLM\\System\\CurrentControlSet\\Services\\SysmonDrv\\*"
  OR registry_key_path="HKLM\\System\\CurrentControlSet\\Services\\Sysmon\\*" OR registry_key_path="HKLM\\System\\CurrentControlSet\\Services\\Sysmon64\\*")
  process_name!="Sysmon64.exe" process_name!="Sysmon.exe" \

  | eval mitre_technique_id="T1054" \

  | `registry_whitelist`\

  | eval indextime = _indextime | convert ctime(indextime) | table _time indextime
  event_description event_type host_fqdn process_path  process_id process_guid registry_key_path
  registry_key_details'
