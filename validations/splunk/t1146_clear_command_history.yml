name: '[T1146] Clear Command History'
author: olafhartong
description: Hunting query based on sysmon or windows events for Splunk
reference: https://github.com/olafhartong/ThreatHunting
integration: Splunk
mitre_technique:
  id: T0000
queries:
- "`indextime` ((`sysmon` event_id=1) OR (`windows-security` event_id=4688)) (process_command_line=\"\
  *rm (Get-PSReadlineOption).HistorySavePath*\" OR process_command_line=\"*del (Get-PSReadlineOption).HistorySavePath*\"\
  \ OR process_command_line=\"*Set-PSReadlineOption \u2013HistorySaveStyle SaveNothing*\"\
  \ OR process_command_line=\"*Remove-Item (Get-PSReadlineOption).HistorySavePath*\"\
  ) \\\n| eval mitre_technique_id=\"T1146\" \\\n| eval hash_sha256= lower(hash_sha256)\
  \ \\\n| `process_create_whitelist` \\\n| eval indextime = _indextime | convert ctime(indextime)\
  \ | table _time indextime event_description hash_sha256 host_fqdn user_name original_file_name\
  \ process_path process_guid process_parent_path process_id process_parent_id process_command_line\
  \ process_parent_command_line process_parent_guid"
