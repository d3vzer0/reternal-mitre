name: '[T1060] Registry Run Keys or Start Folder - Folder Changed'
integration: Splunk
reference: https://github.com/olafhartong/ThreatHunting
description: Hunting query based on sysmon or windows events for Splunk
author: olafhartong
mitre_technique:
  id: T1060
  datasources:
  - Windows Registry
coverage:
  app:
    and: ThreatHunting
  sourcetype:
    and:
    - XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
search: '`indextime` `sysmon` event_id=13 registry_key_path="HKU\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User
  Shell Folders\\Startup" AND registry_key_details!="*\\AppData\\Roaming\\Microsoft\\Windows\\Start
  Menu\\Programs\\Startup"  \

  | eval mitre_technique_id="T1060" \

  | `registry_whitelist`\

  | eval indextime = _indextime | convert ctime(indextime) | table _time indextime
  event_description event_type host_fqdn process_path process_id process_guid registry_key_path
  registry_key_details'
