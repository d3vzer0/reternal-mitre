name: '[T1003] Credential Dumping - Process Access'
integration: Splunk
reference: https://github.com/olafhartong/ThreatHunting
description: Hunting query based on sysmon or windows events for Splunk
author: olafhartong
mitre_technique:
  id: T1003
  datasources:
  - Process monitoring
coverage:
  app:
    and: ThreatHunting
  sourcetype:
    and:
    - XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
search: '`indextime` `sysmon` (event_id=10) (target_process_path="C:\\Windows\\system32\\lsass.exe")
  AND (process_granted_access=0x1010 OR process_granted_access=0x1410 OR process_granted_access=0x147a
  OR process_granted_access=0x143a) process_call_trace="C:\\Windows\\SYSTEM32\\ntdll.dll\*|C:\\Windows\\system32\\KERNELBASE.dll*|UNKNOWN(*)"\

  | eval mitre_technique_id="T1003" \

  | `process_access_whitelist` \

  | eval indextime = _indextime | convert ctime(indextime) | table _time indextime
  event_description host_fqdn process_path target_process_path process_granted_access
  process_guid target_process_guid process_id target_process_id'
