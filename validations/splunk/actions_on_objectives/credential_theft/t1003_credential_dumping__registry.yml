name: '[T1003] Credential Dumping - Registry'
integration: Splunk
reference: https://github.com/olafhartong/ThreatHunting
description: Hunting query based on sysmon or windows events for Splunk
author: olafhartong
mitre_technique:
  id: T1003
  datasources:
  - Windows Registry
coverage:
  sources:
    and:
    - XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
search: '`indextime` `sysmon` (event_id=12 OR event_id=13 OR event_id=14) process_path!="C:\\WINDOWS\\system32\\lsass.exe"  (registry_key_path="*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Authentication\\Credential
  Provider\\*" OR registry_key_path="*\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\*"
  OR registry_key_path="*\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SecurityProviders\\*"
  OR registry_key_path="*\\Control\\SecurityProviders\\WDigest\\*") NOT registry_key_path="*\\Lsa\\RestrictRemoteSamEventThrottlingWindow"
  \

  | eval mitre_technique_id="T1003" \

  | `registry_whitelist`\

  | eval indextime = _indextime | convert ctime(indextime) | table _time indextime
  event_description event_type host_fqdn process_path  process_id process_guid registry_key_path
  registry_key_details'
