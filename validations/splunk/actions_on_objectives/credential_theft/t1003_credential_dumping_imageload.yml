name: '[T1003] Credential Dumping ImageLoad'
integration: Splunk
reference: https://github.com/olafhartong/ThreatHunting
description: Hunting query based on sysmon or windows events for Splunk
author: olafhartong
mitre_technique:
  id: T1003
  datasources:
  - Loaded DLLs
coverage:
  sources:
    or:
    - XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
search: "`indextime` `sysmon` event_id=7 (driver_loaded=\"C:\\\\Windows\\\\System32\\\
  \\samlib.dll\" OR driver_loaded=\"C:\\\\Windows\\\\System32\\\\WinSCard.dll\" OR\
  \ driver_loaded=\"C:\\\\Windows\\\\System32\\\\cryptdll.dll\" OR driver_loaded=\"\
  C:\\\\Windows\\\\System32\\\\hid.dll\" OR driver_loaded=\"C:\\\\Windows\\\\System32\\\
  \\vaultcli.dll\") (process_path!=\"*\\\\Sysmon.exe\" process_path!=\"*\\\\svchost.exe\"\
  \ process_path!=\"*\\\\logonui.exe\")\\\n    | transaction process_guid maxspan=5s\\\
  \n    | eval keep = mvcount(driver_loaded)\\\n    | search keep > 3\\\n    | eval\
  \ mitre_technique_id=\"T1003\" \\\n    | `image_load_whitelist`\\\n    | eval indextime\
  \ = _indextime | convert ctime(indextime) | table _time indextime event_description\
  \ host_fqdn process_path driver_loaded driver_is_signed driver_signature driver_signature_status\
  \ process_id process_guid"
