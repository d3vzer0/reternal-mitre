name: '[T1093] Process Hollowing'
integration: Splunk
reference: https://github.com/olafhartong/ThreatHunting
description: Hunting query based on sysmon or windows events for Splunk
author: olafhartong
mitre_technique:
  id: T1093
  datasources:
  - Process monitoring
  - Process command-line parameters
coverage:
  app:
    and: ThreatHunting
  sourcetype:
    or:
    - XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
    - wineventlog:security
search: '`indextime` ((`sysmon` event_id=1) OR (`windows-security` event_id=4688))
  (process_name="smss.exe" AND process_parent_name!="smss.exe") OR (process_name="csrss.exe"
  AND (process_parent_name!="smss.exe" AND process_parent_name!="svchost.exe")) OR
  (process_name="wininit.exe" AND process_parent_name!="smss.exe") OR (process_name="winlogon.exe"
  AND process_parent_name!="smss.exe") OR (process_name == "lsass.exe" and parent_process_name
  != "wininit.exe") OR (process_name="LogonUI.exe" AND (process_parent_name!="winlogon.exe"
  AND process_parent_name!="wininit.exe")) OR (process_name="services.exe" AND process_parent_name!=
  "wininit.exe") OR (process_name="spoolsv.exe" AND process_parent_name!= "services.exe")
  OR (process_name="taskhost.exe" AND (process_parent_name!="services.exe" AND process_parent_name!="svchost.exe"))
  OR (process_name="taskhostw.exe" AND (process_parent_name!="services.exe" AND process_parent_name!="svchost.exe"))
  OR (process_name="userinit.exe" AND (process_parent_name!="dwm.exe" AND process_parent_name!="winlogon.exe"))  \

  | eval mitre_technique_id="T1093" \

  | eval hash_sha256= lower(hash_sha256)\

  | `process_create_whitelist`\

  | eval indextime = _indextime | convert ctime(indextime) | table _time indextime
  event_description hash_sha256 host_fqdn user_name original_file_name process_path
  process_guid process_parent_path process_id process_parent_id process_command_line
  process_parent_command_line process_parent_guid'
