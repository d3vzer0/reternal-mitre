name: '[T1036] Masquerading - Extension'
author: olafhartong
description: Hunting query based on sysmon or windows events for Splunk
reference: https://github.com/olafhartong/ThreatHunting
integration: Splunk
mitre_technique:
  id: T1036
queries:
- '`indextime` ((`sysmon` event_id=1) OR (`windows-security` event_id=4688)) (process_name="*.doc.*"
  OR process_name="*.docx.*" OR process_name="*.xls.*" OR process_name="*.xlsx.*"
  OR process_name="*.pdf.*" OR process_name="*.rtf.*" OR process_name="*.jpg.*" OR
  process_name="*.png.*" OR process_name="*.jpeg.*"  OR process_name="*.zip.*" OR
  process_name="*.rar.*"  OR process_name="*.ppt.*" OR process_name="*.pptx.*")\

  | eval mitre_technique_id="T1036" \

  | eval hash_sha256= lower(hash_sha256)\

  | `process_create_whitelist`\

  | eval indextime = _indextime | convert ctime(indextime) | table _time indextime
  event_description hash_sha256 host_fqdn user_name original_file_name process_path
  process_guid process_parent_path process_id process_parent_id process_command_line
  process_parent_command_line process_parent_guid'
